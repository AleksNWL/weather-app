import { getMagneticStorm, KPDataPoint } from "../../services/getMagneticStorm.ts";
import { useEffect, useState } from "react";
import { Skeleton } from "@mui/material";
import styles from "./MagneticStorm.module.scss";

export default function MagneticStorm() {
    const [data, setData] = useState<KPDataPoint[] | null>(null);

    useEffect(() => {
        getMagneticStorm().then(setData);
    }, []);

    if (!data) {
        return (
            <div className={styles.skeletonWrapper}>
                <Skeleton variant="rectangular" width={210} height={60} />
                <Skeleton variant="text" sx={{ fontSize: '1rem', mt: 2, width: 300 }} />
            </div>
        );
    }

    const dictionaryKp: Record<number, { color: string, info: string }> = {
        0: { color: "#00e400", info: "Магнитное поле спокойно, нарушений нет" },
        1: { color: "#a8e05f", info: "Слабая буря: возможны небольшие сбои связи" },
        2: { color: "#fdd64b", info: "Умеренная буря: могут быть проблемы с навигацией и связью" },
        3: { color: "#ff9b57", info: "Сильная буря: возможны сбои электросети и радиосвязи" },
        4: { color: "#fe6a69", info: "Очень сильная буря: риск серьезных нарушений" },
        5: { color: "#a97abc", info: "Экстремальная буря: крупные сбои в электронике и энергетике" }
    };

    const level = (kpIndex: number | undefined): number => {
        if (!kpIndex) kpIndex = 0;

        if (kpIndex > 0 && kpIndex <= 3) return 0;
        if (kpIndex === 4) return 1;
        if (kpIndex === 5) return 2;
        if (kpIndex === 6) return 3;
        if (kpIndex > 6 && kpIndex <= 8) return 4;
        if (kpIndex === 9) return 5;

        return 0;
    };

    const kpIndex = level(data.at(data.length - 1)?.kp_index);
    const kpInfo = dictionaryKp[kpIndex];

    return (
        <>
            <div className={styles.img}>
                <svg width="90" height="60" viewBox="0 0 90 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M88.3494 56.2229C86.4226 57.7981 83.5781 57.5187 81.9964 55.5991L81.9708 55.5665C81.3016 54.7551 80.4893 54.3045 79.6843 54.3045C79.6837 54.3045 79.6831 54.3045 79.6825 54.3045C78.8757 54.3045 78.0623 54.6846 77.3918 55.5005C75.006 58.4039 71.628 59.9997 68.1182 59.9997C68.1149 59.9997 68.1116 59.9997 68.1083 59.9997C64.6027 59.9997 61.2268 58.4164 58.8443 55.5278L58.8115 55.5608C58.2289 54.854 57.5361 54.4217 56.8344 54.3234C56.7585 54.3156 56.6827 54.3045 56.6072 54.3045C56.6066 54.3045 56.606 54.3045 56.6054 54.3045C55.7986 54.3045 54.9851 54.6849 54.3146 55.5005C51.9288 58.4039 48.5508 59.9997 45.0407 59.9997C45.0374 59.9997 45.0344 59.9997 45.0311 59.9997C41.5255 59.9997 38.1496 58.4155 35.7674 55.5269L35.7566 55.586C35.0714 54.7554 34.2588 54.3048 33.4542 54.3048C33.4535 54.3048 33.4529 54.3048 33.4523 54.3048C32.6525 54.3048 31.8454 54.7143 31.1779 55.5176C31.1707 55.5266 31.1631 55.502 31.1565 55.5104C28.7758 58.4072 25.3972 60 21.8871 60C21.8841 60 21.8808 60 21.8778 60C18.3722 60 14.9963 58.4176 12.6141 55.5287L12.5813 55.5626C11.9132 54.7524 11.101 54.3048 10.296 54.3048C10.2954 54.3048 10.2948 54.3048 10.2948 54.3048C9.48892 54.3051 8.6761 54.7539 8.00591 55.5683C6.4248 57.4884 3.58127 57.7687 1.65318 56.1944C-0.274604 54.6199 -0.555978 51.787 1.02453 49.8668C3.40583 46.9743 6.78352 45.3143 10.2912 45.3128C10.2927 45.3128 10.2945 45.3128 10.296 45.3128C13.8016 45.3128 17.1775 46.9323 19.5597 49.8207L19.5925 49.8237C20.2609 50.6342 21.0731 51.0079 21.8781 51.0079C21.8787 51.0079 21.8793 51.0079 21.8799 51.0079C22.6801 51.0079 23.4872 50.6366 24.1547 49.8329C24.1619 49.8243 24.1691 49.8872 24.1757 49.8791C26.5564 46.9824 29.935 45.3131 33.4451 45.3131C33.4481 45.3131 33.4514 45.3131 33.4545 45.3131C36.96 45.3131 40.3359 46.9356 42.7181 49.8243L42.729 49.8036C43.4142 50.6342 44.2267 51.0082 45.0314 51.0082C45.032 51.0082 45.0326 51.0082 45.0332 51.0082C45.6974 51.0082 46.3642 50.772 46.9541 50.2091C47.0465 50.067 47.1452 50.0011 47.2556 49.8671C49.6369 46.9746 53.0146 45.3146 56.522 45.3131C56.5235 45.3131 56.5256 45.3131 56.5271 45.3131C56.7694 45.3131 57.0107 45.3137 57.2518 45.3293C60.5244 45.5184 63.6358 47.1343 65.8717 49.8458L65.8985 49.8596C65.9999 49.9825 66.0929 50.0727 66.1793 50.2028C66.7706 50.77 67.4417 51.0082 68.1095 51.0082C68.1101 51.0082 68.1107 51.0082 68.1113 51.0082C68.9181 51.0082 69.7312 50.6282 70.4017 49.8123C72.7878 46.9086 76.1661 45.3131 79.6762 45.3131C79.6792 45.3131 79.6825 45.3131 79.6855 45.3131C83.1911 45.3131 86.567 46.9722 88.9492 49.8611L88.976 49.8965C90.5565 51.8152 90.2766 54.6475 88.3494 56.2229ZM79.6843 22.5316C79.6813 22.5316 79.678 22.5316 79.6747 22.5316C76.1766 22.5316 72.8089 24.2281 70.4294 27.1072C70.4198 27.1189 70.4098 27.1893 70.3999 27.2013C69.7294 28.0172 68.916 28.5265 68.1098 28.5265C68.1092 28.5265 68.1083 28.5265 68.1077 28.5265C67.4402 28.5265 66.7691 28.1764 66.1778 27.6096C66.0953 27.4852 66.0066 27.3446 65.9103 27.2268L65.8702 27.1686C63.6331 24.4556 60.5196 22.7876 57.2451 22.5996C57.0059 22.584 56.7664 22.5316 56.5256 22.5316C56.5241 22.5316 56.5226 22.5316 56.5211 22.5316C53.0134 22.5316 49.6357 24.2308 47.2544 27.1234C47.144 27.2574 47.045 27.4543 46.9526 27.5964C46.363 28.1593 45.6956 28.5265 45.0317 28.5265C45.0308 28.5265 45.0302 28.5265 45.0296 28.5265C44.2246 28.5265 43.4124 28.0409 42.7407 27.2262L42.7166 27.1369C40.3344 24.2479 36.9585 22.5316 33.4529 22.5316C33.4496 22.5316 33.4466 22.5316 33.4433 22.5316C29.9332 22.5316 26.5546 24.2773 24.1694 27.1803C23.4986 27.9965 22.6852 28.5265 21.8787 28.5265C21.8778 28.5265 21.8775 28.5265 21.8766 28.5265C21.0716 28.5265 20.2594 28.0409 19.5913 27.2304L19.5585 27.1336C17.1766 24.2449 13.8004 22.5316 10.2948 22.5316C10.2933 22.5316 10.2918 22.5316 10.2903 22.5316C6.78261 22.5316 3.40492 24.2308 1.02363 27.1234C-0.557182 29.0435 -0.275808 31.8956 1.65168 33.4702C3.57977 35.0447 6.4239 34.7363 8.00441 32.8161C8.67519 32.0017 9.48802 31.5242 10.2939 31.5242C10.2939 31.5242 10.2942 31.5242 10.2948 31.5242C11.0995 31.5242 11.912 32.0098 12.5801 32.8203L12.6129 32.9171C14.9951 35.8061 18.371 37.5191 21.8766 37.5191C21.8799 37.5191 21.8829 37.5191 21.8862 37.5191C25.3963 37.5191 28.7749 35.7734 31.1601 32.8704C31.8309 32.0542 32.6443 31.5242 33.4508 31.5242C33.4517 31.5242 33.452 31.5242 33.4529 31.5242C34.2579 31.5242 35.0702 32.0128 35.7419 32.8278L35.7659 32.9156C38.1481 35.8046 41.524 37.5191 45.0296 37.5191C45.0326 37.5191 45.0359 37.5191 45.0392 37.5191C48.5379 37.5191 51.9057 35.8253 54.2848 32.9459C54.2945 32.9345 54.3038 32.8626 54.3134 32.8512C54.9842 32.035 55.7976 31.5242 56.6042 31.5242C56.6051 31.5242 56.6054 31.5242 56.6063 31.5242C56.6812 31.5242 56.7561 31.5734 56.8311 31.5809C57.5334 31.6786 58.2271 32.1297 58.8103 32.8377L58.8431 32.9261C61.2256 35.8148 64.6015 37.5191 68.1068 37.5191C68.1101 37.5191 68.1137 37.5191 68.117 37.5191C71.6148 37.5191 74.9819 35.8259 77.3608 32.9477C77.371 32.9357 77.3807 32.8635 77.3909 32.8512C78.0617 32.035 78.8751 31.5242 79.6816 31.5242C79.6822 31.5242 79.6828 31.5242 79.6837 31.5242C80.4887 31.5242 81.3006 32.0128 81.9567 32.808L81.9823 32.8599C83.5552 34.7867 86.3982 35.0885 88.3326 33.5223C90.267 31.9556 90.5598 29.129 88.9874 27.2025L88.9474 27.1153C86.5661 24.2263 83.1902 22.5316 79.6843 22.5316ZM1.65228 10.7855C3.58037 12.3597 6.4239 12.1532 8.00501 10.233C8.67549 9.41864 9.48832 9.04336 10.2939 9.04336H10.2948C11.0998 9.04336 11.912 9.41744 12.5804 10.2279L12.6132 10.2306C14.9954 13.1196 18.3713 14.7385 21.8769 14.7385C21.8802 14.7385 21.8832 14.7385 21.8865 14.7385C25.3966 14.7355 28.7752 13.1427 31.1604 10.2396C31.8312 9.42343 32.6446 9.04336 33.4511 9.04336C33.452 9.04336 33.4523 9.04336 33.4532 9.04336C34.2582 9.04336 35.0705 9.42014 35.7422 10.2351L35.7662 10.2288C38.1484 13.1178 41.5243 14.7388 45.0299 14.7385C45.0329 14.7385 45.0362 14.7385 45.0395 14.7385C48.5382 14.7355 51.906 13.083 54.2851 10.2034C54.2948 10.192 54.3041 10.251 54.3137 10.2396C54.9845 9.42343 55.7979 9.04336 56.6045 9.04336C56.6054 9.04336 56.6057 9.04336 56.6066 9.04336C56.6821 9.04336 56.7576 8.98071 56.8332 8.9885C57.5349 9.08682 58.2277 9.48218 58.8106 10.1893L58.8434 10.2115C61.2259 13.1001 64.6018 14.7385 68.1071 14.7382C68.1104 14.7382 68.114 14.7382 68.1173 14.7382C71.6151 14.7349 74.9822 13.0833 77.3611 10.2049C77.3713 10.1929 77.381 10.2513 77.3912 10.2393C78.062 9.42314 78.8754 9.04306 79.6819 9.04306C79.6825 9.04306 79.6831 9.04306 79.684 9.04306C80.489 9.04306 81.301 9.41984 81.957 10.2154L81.9826 10.2115C83.5556 12.1382 86.3985 12.4122 88.3329 10.846C90.2673 9.27926 90.5601 6.43887 88.9877 4.51211L88.9477 4.5295C86.5655 1.64056 83.1896 0.0507099 79.684 0.0507099C79.681 0.0507099 79.6777 0.0507099 79.6744 0.0507099C76.1763 0.0507099 72.8086 1.63576 70.4291 4.51451C70.4195 4.5262 70.4095 4.50282 70.3996 4.51481C69.7291 5.33072 68.9157 5.74526 68.1095 5.74586C68.1089 5.74586 68.108 5.74586 68.1074 5.74586C67.4399 5.74586 66.7688 5.43413 66.1775 4.86701C66.095 4.74262 66.0063 4.62122 65.91 4.50312L65.8699 4.45456C63.634 1.74307 60.5223 0.19159 57.25 0.00245122C57.0092 -0.0131355 56.7679 0.0507099 56.5256 0.0507099C56.5241 0.0507099 56.5223 0.0507099 56.5205 0.0507099C53.0131 0.0507099 49.6354 1.63846 47.2541 4.5313C47.1437 4.66528 47.0447 4.7678 46.9526 4.91018C46.363 5.4731 45.6956 5.74556 45.0317 5.74616C45.0308 5.74616 45.0302 5.74616 45.0296 5.74616C44.2246 5.74616 43.4124 5.29894 42.7407 4.48394L42.7166 4.5253C40.3344 1.63636 36.9585 0.0510095 33.4529 0.0510095C33.4496 0.0510095 33.4466 0.0510095 33.4433 0.0510095C29.9332 0.0510095 26.5546 1.64685 24.1694 4.54988C23.4986 5.36609 22.6852 5.74556 21.8787 5.74616C21.8778 5.74616 21.8775 5.74616 21.8766 5.74616C21.0716 5.74616 20.2594 5.29894 19.5913 4.48843L19.5585 4.52261C17.1766 1.63396 13.8004 0.0513091 10.2948 0.0513091C10.2933 0.0513091 10.2915 0.0513091 10.29 0.0513091C6.78231 0.0513091 3.40462 1.63906 1.02333 4.5319C-0.556881 6.45146 -0.275808 9.21092 1.65228 10.7855Z" fill={kpInfo.color}/>
                </svg>
            </div>
            <span className={styles.description}>{kpInfo.info}</span>
        </>
    )
}